#!/bin/bash
# bash script to ask GTFObins if privesc vector exists for SUID files
#
# > After running `find / -type f -perm /4000 2>/dev/null` on a compromised host, 
#   save the resulting SUID paths to a file on your local machine and run this script
#   to quickly see whether any of them can be used for privilege escalation.
#
# usage: ./binq.sh suid.txt

red="\e[31m"
green="\e[32m"
mag="\e[35m"
cyan="\e[36m"
reset="\e[0m"

echo
echo "================================================"
echo -e "================= ${cyan}gtfoBINs Query${reset} ==============="
echo "================================================"
echo -e "                                       ${cyan}@suffs811${reset}"

if [ "$1" == "" ]
then
	echo
	echo "+--------------------------------+"
	echo -e "${mag}usage: ./binq.sh <suid_list_file>${reset}"
	echo "+--------------------------------+"
	echo

else
	declare -a success=()
	echo
	echo "[#] Searching GTFObins for:"
	for i in $(cat $1);
	do
		k=(${i//\// })
		l=${#k[@]}
		j=$(echo $i | cut -d "/" -f $((l+1)))
		echo [*] $j
	done
	echo
	echo "+ + + + + + + + + + + + + + + + + + + + + + + +"
	echo
	echo "[#] Gathering response codes..."
	for i in $(cat $1);
	do
		k=(${i//\// })
		l=${#k[@]}
		j=$(echo $i | cut -d "/" -f $((l+1)))
		r=$(curl -I -L -s -w '%{response_code}\n' -o /dev/null "https://gtfobins.github.io/gtfobins/$j")
		if [ $r == "200" ]
		then
			echo -e "${green}[+] $j [$r]${reset}"
			success+=($j)
		else
			echo -e "${mag}[-] $j [$r]${reset}"
		fi
	done
	echo

	echo "################## Findings: ##################"
	echo
	if [ "$success" == "" ]
	then
		echo -e "${mag}[-] No GTFObins entries found :(${reset}"
	else
		for s in ${success[@]};
		do
			echo -e "${green}[+]${reset} GTFObins has an entry for $(echo $s | tr -d "/")!"
		done
	fi
	echo
	echo "###############################################"
	echo
	echo ">> GTFObins: https://gtfobins.github.io/"
	echo
fi
