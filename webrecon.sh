#!/bin/bash

red="\e[31m"
green="\e[32m"
reset="\e[0m"

if [ "$1" = "" ] || [ "$1" = " " ];then
	echo
	echo -e "${red}[-] provide an ip address${reset}"
	echo
	echo "usage: webrecon 10.0.0.0"
	echo
	exit
fi

if [[ "$1" == *":"* ]];then
	port = $(echo $1 | tr ":")[1]
fi

ip="http://$1"

echo -e "${green}################################${reset}"
echo -e "${green}########## ${red}WebRecon${reset} ${green}############${reset}"
echo -e "${green}################################${reset}"
echo
echo "[#] Scanning $ip..."
echo

if [ ! -d "web" ];then
	mkdir web
fi
if [ ! -d "web/recon" ];then
	mkdir web/recon
fi

echo
echo -e "${green}[+] findings services and versions...${reset}"
whatweb $ip | tee web/recon/whatweb.txt

echo 
echo -e "${green}[+] scanning robots.txt...${reset}"
curl $ip/robots.txt | tee web/recon/robots.txt

echo
echo -e "${green}[+] getting directories...${reset}"
ffuf -timeout 2 -r -u $ip/FUZZ -w /usr/share/wordlists/dirb/big.txt:FUZZ -c | tee web/recon/directories.txt

echo
dirb $ip /usr/share/wordlists/dirb/big.txt | tee -a web/recon/directories.txt

echo
gobuster dir -r --timeout 2s -u $ip -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt | tee -a web/recon/directories.txt

echo
echo -e "${green}[+] scanning with nikto...${reset}"
nikto -h $ip -t 2 -F htm -o web/recon/nikto.html

echo
echo -e "${green}[+] getting subdomains...${reset}"
assetfinder $ip | tee web/recon/subdomains.txt

echo
echo -e "${green}[+] finding http/s servers...${reset}"
if [ -n "$port" ];then
	httprobe $ip -p http:$port | tee web/recon/servers.txt
else
	httprobe $ip | tee web/recon/servers.txt
fi

echo
echo -e "${green}[+] enumerating attack surface...${reset}"
if [ -n "$port" ];then
	amass intel -d $ip -whois -addr $ip -p $port -dir web/recon/ -active -o web/recon/amass_intel.txt
else
	amass intel -d $ip -whois -addr $ip -dir web/recon/ -active -o web/recon/amass_intel.txt
fi

echo
echo "[#] results saved to web/recon/"
echo
