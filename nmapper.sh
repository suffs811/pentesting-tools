#!/bin/bash
# STATUS: in development

ip=$1

if [ "$ip" == "" ]
then
	echo "[-] no ip given..."
	echo
	echo "usage: nmapper 10.0.0.0"
	echo
	exit
else
	echo
	echo "################################"
	echo "########## Nmapper #############"
	echo "################################"
	echo
 	echo "[*] what would you like to do?"
	echo
	echo "[0] EVERYTHING BAGEL *discovery, ports, services, and vulnerabilities*"
	echo "[1] host discovery"
	echo "[2] port scan"
	echo "[3] services/vulnerability scan"
	echo "[4] ports & services/vulns scan"
	echo
	read -p "[+] " scan
	echo
	network=$(echo "$ip" | cut -d '.' -s -f 1-3)'.0'
	range=$network'/24'
	if [ $scan == 0 ]
	then
		echo "[*] starting full scan on $ip"
		echo
		echo "[*] starting host discovery"
		echo
		live_targets=$(nmap -v -PE -sn -oN $network_host_disc.nmap $range | grep -v 'up' | grep -v 'down' | grep -i 'report' | cut -d " " -f 5 | tee -a live-targets.txt)
		echo "[###] the following hosts are up:"
		echo 
		echo $live_targets
		echo
		echo "[*] starting port scan and services/vulnerability scan"
		open_ports=$(nmap -vv -sS -n -oN $network_ports.nmap -p- -iL live-targets.txt | grep "Discovered" | grep -v "Host" | tr -d "Discoveredopenport/" | cut -d " " -f 4,6)
		echo
		echo "[###] the following ports are open:"
		echo
		echo $open_ports
		echo
		echo "[*] starting services scan"
		svcs_vulns=$(nmap -vv -sS -n -oN $network_svcs.nmap -p- -sC -sV --script=vuln -iL live-targets.txt | grep "open\|report" | grep -v "Discovered" | grep -v "Service")
		echo 
		echo "[###] the following services were found:"
		echo
		for i in $svcs_vulns;
		do
			if [ "Nmap" in $i ]
			then
				echo 
				echo $i
			else
				echo $i
			fi
		done
		echo
		echo "[*] additional details about services and vulnerabilities is at $network_svcs.nmap"
	elif [ $scan == 1 ]
	then
		echo "[*] starting host discovery for $range"
		echo
		live_hosts=$(nmap -v -PE -sn -oN $network_host_disc.nmap $range | grep -v 'up' | grep -v 'down' | grep -i 'report' | cut -d " " -f 5 | tee -a live-targets.txt)
		echo "[#] The following hosts are up:"
		echo 
		echo $live_hosts
		echo
	elif [ $scan == 2 ]
	then
		echo "[*] starting port scan on $ip"
		echo
		nmap -vv -sS -Pn -n -T4 -oN $ip-ports.nmap -p- $ip
	elif [ $scan == 3 ]
	then
		echo "[*] enter ports: (22,80,443)"
		read -p "[+] " ports
		echo
		echo "[*] starting services/vulnerability scan on $ip"
		echo
		nmap -vv -sC -sV -n --script=vuln -oN $ip_svcs.nmap -p $ports $ip
 	elif [ $scan == 4 ]
	then
 		echo "[*] scan all ports [0] or most common ports [1]?"
   		read -p "[+] " num
     		if [ $num == 0 ]
       		then
			echo "[*] starting all ports & services scan for $ip"
			echo
			nmap -vv -A -n -T5 -sS --script=vuln -oN $ip_ports_svcs.nmap -p- $ip
   		elif [ $num == 1 ]
     		then
       			echo "[*] starting common ports & services scan for $ip"
			echo
			nmap -vv -A -n -T5 -sS --script=vuln -oN $ip_ports_svcs.nmap $ip
   		else
     			echo "[-] invalid option given..."
			echo
   			exit
      		fi
	else
		echo "[-] invalid option given..."
		echo
		exit
	fi
fi
